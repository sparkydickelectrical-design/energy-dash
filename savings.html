<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        // Security Gate
        if (localStorage.getItem('peakShavingAuth') !== 'true') { window.location.href = "login.html"; }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <title>Savings | PeakShaving Hub</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="style.css?v=5.3">
</head>
<body>
    <nav class="main-nav">
        <div class="nav-top">
            <div class="brand-logo">PeakShaving <span>Energy Hub</span></div>
            <div class="nav-links">
                <a href="index.html" class="nav-item">Home</a>
                <a href="savings.html" class="nav-item active">Savings</a>
                <a href="#" onclick="logout()" class="nav-item" style="color:#ef4444">Logout</a>
            </div>
        </div>
    </nav>

    <div class="scroll-content">
        <section class="savings-hero-card">
            <div class="hero-label">Total Estimated Savings</div>
            <div class="hero-value">£142.50</div>
            <div id="dst-status" class="hero-subtext">Checking Meter Sync...</div>
        </section>

        <div class="stats-mini-grid">
            <div class="mini-box border-green">
                <i data-lucide="trending-down" class="green-text"></i>
                <div class="mini-info">
                    <strong>£84.20</strong>
                    <span>Avoided Peak Costs</span>
                </div>
            </div>
            <div class="mini-box border-blue">
                <i data-lucide="leaf" class="blue-text"></i>
                <div class="mini-info">
                    <strong>12.4 <small>kg</small></strong>
                    <span>CO2 Offset</span>
                </div>
            </div>
        </div>

        <div class="daily-header"><h2>Economy 7 Breakdown</h2></div>
        <div class="financial-section">
            <div class="tariff-card">
                <div class="tariff-header">
                    <i data-lucide="clock" class="blue-text"></i>
                    <span id="tariff-label">Economy 7 Schedule</span>
                </div>
                <div class="tariff-split">
                    <div class="rate-box" id="day-box">
                        <div class="rate-label"><i data-lucide="sun"></i> Day Rate</div>
                        <div class="rate-price">28.5<small>p</small></div>
                        <div id="peak-time" class="rate-period">08:00 — 01:00</div>
                    </div>
                    <div class="rate-box" id="night-box">
                        <div class="rate-label"><i data-lucide="moon"></i> Night Rate</div>
                        <div class="rate-price green-text">7.5<small>p</small></div>
                        <div id="night-time" class="rate-period">01:00 — 08:00</div>
                    </div>
                </div>
            </div>

            <div class="daily-card border-green">
                <div class="daily-top">
                    <i data-lucide="zap" class="orange-text"></i>
                    <div class="card-title">Independence</div>
                    <div class="stat-ring">88%</div>
                </div>
                <p class="card-description">Your load coverage from solar and storage during peak hours.</p>
            </div>
        </div>

        <div class="daily-header"><h2>Projected Monthly</h2></div>
        <div class="daily-card" style="margin-bottom: 30px;">
            <div class="card-details">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px;">
                    <span style="color: #94a3b8;">Est. Hub Bill</span>
                    <strong class="green-text">£42.10</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="color: #94a3b8;">Standard Flat Rate</span>
                    <strong style="color: #ef4444;">£118.40</strong>
                </div>
                <p style="font-size: 0.7rem; color: #64748b; margin-top: 10px;">*Calculation based on average Bangor solar yields.</p>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        function logout() { localStorage.removeItem('peakShavingAuth'); window.location.href = "login.html"; }

        function updateEconomy7() {
            const now = new Date();
            const isBST = now.getTimezoneOffset() < 0;
            const zone = isBST ? "BST" : "GMT";
            
            // Logic for GMT-locked meter behavior
            const nStart = isBST ? "02:00" : "01:00";
            const nEnd = isBST ? "09:00" : "08:00";
            const dStart = isBST ? "09:00" : "08:00";
            const dEnd = isBST ? "02:00" : "01:00";

            document.getElementById('night-time').innerText = `${nStart} — ${nEnd}`;
            document.getElementById('peak-time').innerText = `${dStart} — ${dEnd}`;
            document.getElementById('dst-status').innerText = `Meter tracking ${zone} Shift (01:00 GMT Base)`;
            document.getElementById('tariff-label').innerText = `${zone} Economy 7 Schedule`;

            // Active Glow Logic based on current time
            const hour = now.getHours();
            const startHour = isBST ? 2 : 1;
            const endHour = isBST ? 9 : 8;
            
            if (hour >= startHour && hour < endHour) {
                document.getElementById('night-box').classList.add('active-glow');
                document.getElementById('day-box').classList.remove('active-glow');
            } else {
                document.getElementById('day-box').classList.add('active-glow');
                document.getElementById('night-box').classList.remove('active-glow');
            }
        }
        updateEconomy7();
    </script>
</body>
</html>
