<!DOCTYPE html>
<html lang="en">
<head>
    <script>if (localStorage.getItem('peakShavingAuth') !== 'true') { window.location.href = "login.html"; }</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Professional Analytics | PeakShaving Hub</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css?v=12.0">
</head>
<body>
    <nav class="main-nav">
        <div class="nav-top">
            <div class="brand-logo">PeakShaving <span>Analytics Engine</span></div>
            <div class="nav-links">
                <a href="index.html" class="nav-item">Home</a>
                <a href="savings.html" class="nav-item">Savings</a>
                <a href="analytics.html" class="nav-item active">Analytics</a>
                <a href="#" onclick="logout()" class="nav-item" style="color:#ef4444">Logout</a>
            </div>
        </div>
    </nav>

    <div class="scroll-content">
        <div class="analytics-grid">
            <div class="stat-card">
                <span class="stat-label">Inverter Efficiency</span>
                <span class="stat-value">98.4%</span>
                <span class="stat-trend green-text">â–² 0.2% vs baseline</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">Phase Alignment</span>
                <span class="stat-value">232 <small>V</small></span>
                <span class="stat-trend blue-text">Balanced across L1-L3</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">Solar Utilization</span>
                <span class="stat-value">84%</span>
                <span class="stat-trend green-text">Direct consumption max</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">Uptime (30d)</span>
                <span class="stat-value">99.9%</span>
                <span class="stat-trend">Standard operation</span>
            </div>
        </div>

        <div class="daily-header"><h2>Energy Flux Correlation</h2></div>
        <div class="daily-card" style="height: 400px; padding: 20px;">
            <canvas id="proAnalyticsChart"></canvas>
        </div>

        <div class="daily-header"><h2>Sub-System Audit History</h2></div>
        <div class="daily-card" style="padding: 0; overflow: hidden; border-radius: 22px;">
            <table class="audit-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Sub-System</th>
                        <th>Event Parameter</th>
                        <th style="text-align:right;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>01:00</td><td>Grid Meter</td><td>Tariff Switch: GMT Night</td><td style="text-align:right;" class="green-text">SYNC</td></tr>
                    <tr><td>25/02</td><td>BMS Main</td><td>Battery Balancing: Cell 1-16</td><td style="text-align:right;">HEALTHY</td></tr>
                    <tr><td>25/02</td><td>Inverter</td><td>Peak Shaving Engaged</td><td style="text-align:right;" class="blue-text">3.2kW OFFSET</td></tr>
                    <tr><td>25/02</td><td>EVSE</td><td>Load Shedding: Enabled</td><td style="text-align:right; color:#ef4444;">HOLD</td></tr>
                    <tr><td>25/02</td><td>PV String A</td><td>Max Power Point Reached</td><td style="text-align:right;" class="orange-text">4.4kW</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const ctx = document.getElementById('proAnalyticsChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '23:59'],
                datasets: [
                    {
                        label: 'Battery SoC (%)',
                        data: [20, 85, 100, 92, 75, 40, 25],
                        borderColor: '#a855f7',
                        backgroundColor: 'rgba(168, 85, 247, 0.05)',
                        fill: true,
                        yAxisID: 'y1',
                        tension: 0.4,
                        borderWidth: 3
                    },
                    {
                        label: 'Solar (kW)',
                        data: [0, 0, 1.5, 4.8, 3.2, 0.4, 0],
                        borderColor: '#4ade80',
                        yAxisID: 'y',
                        tension: 0.4,
                        borderWidth: 3
                    },
                    {
                        label: 'House (kW)',
                        data: [0.6, 0.4, 2.8, 1.2, 4.5, 3.5, 0.8],
                        borderColor: '#3b82f6',
                        borderDash: [5, 5],
                        yAxisID: 'y',
                        tension: 0.4,
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { position: 'bottom', labels: { color: '#94a3b8', font: { size: 10, weight: 'bold' }, boxWidth: 10, usePointStyle: true } }
                },
                scales: {
                    y: { 
                        type: 'linear', display: true, position: 'left',
                        grid: { color: 'rgba(255,255,255,0.05)' },
                        ticks: { color: '#64748b' },
                        title: { display: true, text: 'Real Power (kW)', color: '#64748b' }
                    },
                    y1: { 
                        type: 'linear', display: true, position: 'right',
                        grid: { drawOnChartArea: false },
                        ticks: { color: '#a855f7' },
                        title: { display: true, text: 'Charge State (%)', color: '#a855f7' }
                    },
                    x: { ticks: { color: '#64748b' }, grid: { display: false } }
                }
            }
        });
    </script>
</body>
</html>
