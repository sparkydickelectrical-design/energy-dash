<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        if (localStorage.getItem('peakShavingAuth') !== 'true') { 
            window.location.replace("login.html"); 
        }
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Professional Analytics Suite | PeakShaving Pro</title>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css?v=17.0">
</head>
<body>
    <nav class="main-nav">
        <div class="nav-top">
            <div class="brand-logo">PeakShaving <span>Professional</span></div>
            <div class="nav-links">
                <a href="index.html" class="nav-item">Home</a>
                <a href="savings.html" class="nav-item">Savings</a>
                <a href="analytics.html" class="nav-item active">Analytics</a>
                <button onclick="logoutSystem()" class="logout-btn">Terminate Session</button>
            </div>
        </div>
    </nav>

    <main class="scroll-content">
        <section class="analytics-kpi-grid">
            <div class="kpi-card-pro">
                <div class="kpi-header">
                    <span class="label">Inverter Performance</span>
                    <i data-lucide="activity" class="blue-text icon-xs"></i>
                </div>
                <div class="kpi-body">
                    <span class="value">98.42%</span>
                    <span class="trend green-text">▲ 0.12% vs Baseline</span>
                </div>
            </div>

            <div class="kpi-card-pro">
                <div class="kpi-header">
                    <span class="label">Harmonic Distortion (THD)</span>
                    <i data-lucide="waves" class="green-text icon-xs"></i>
                </div>
                <div class="kpi-body">
                    <span class="value">&lt; 1.5%</span>
                    <span class="trend">Grid Quality: Clean</span>
                </div>
            </div>

            <div class="kpi-card-pro">
                <div class="kpi-header">
                    <span class="label">Self-Sufficiency Ratio</span>
                    <i data-lucide="leaf" class="green-text icon-xs"></i>
                </div>
                <div class="kpi-body">
                    <span class="value">84.1%</span>
                    <span class="trend green-text">Maximized Autonomy</span>
                </div>
            </div>

            <div class="kpi-card-pro">
                <div class="kpi-header">
                    <span class="label">Inverter Temperature</span>
                    <i data-lucide="thermometer" class="red-text icon-xs"></i>
                </div>
                <div class="kpi-body">
                    <span class="value">38.4°C</span>
                    <span class="trend">Cooling: Optimal</span>
                </div>
            </div>
        </section>

        <section class="chart-operations-block">
            <div class="block-header">
                <h2 class="title-text">24h Power Flux & SOC Correlation</h2>
            </div>
            <div class="daily-card graph-canvas-wrapper">
                <canvas id="scadaFluxEngine"></canvas>
            </div>
        </section>

        <section class="telemetry-table-block">
            <div class="block-header">
                <h2 class="title-text">Inverter Phase Audit & Balancing</h2>
            </div>
            <div class="daily-card table-responsive">
                <table class="pro-telemetry-table">
                    <thead>
                        <tr>
                            <th>Phase Reference</th>
                            <th>Voltage (RMS)</th>
                            <th>Current (A)</th>
                            <th>Phase Angle</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Phase L1 (Master)</td>
                            <td>231.4V</td>
                            <td>4.2A</td>
                            <td>0.0°</td>
                            <td><span class="status-badge sync">SYNCED</span></td>
                        </tr>
                        <tr>
                            <td>Phase L2</td>
                            <td>230.8V</td>
                            <td>3.8A</td>
                            <td>120.1°</td>
                            <td><span class="status-badge sync">SYNCED</span></td>
                        </tr>
                        <tr>
                            <td>Phase L3</td>
                            <td>232.1V</td>
                            <td>4.1A</td>
                            <td>240.2°</td>
                            <td><span class="status-badge sync">SYNCED</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        lucide.createIcons();

        // SCADA FLUX ENGINE INITIALIZATION
        const canvasCtx = document.getElementById('scadaFluxEngine').getContext('2d');
        
        const analyticsChart = new Chart(canvasCtx, {
            type: 'line',
            data: {
                labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00', '23:59'],
                datasets: [
                    {
                        label: 'Storage SoC (%)',
                        data: [20, 75, 95, 100, 92, 85, 55, 35, 25],
                        borderColor: '#a855f7',
                        backgroundColor: 'rgba(168, 85, 247, 0.05)',
                        fill: true,
                        yAxisID: 'yAxisSOC',
                        tension: 0.4,
                        borderWidth: 4,
                        pointRadius: 0
                    },
                    {
                        label: 'Solar Yield (kW)',
                        data: [0, 0, 0.2, 3.2, 5.4, 4.1, 1.1, 0, 0],
                        borderColor: '#4ade80',
                        yAxisID: 'yAxisPower',
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 3,
                        pointBackgroundColor: '#4ade80'
                    },
                    {
                        label: 'House Demand (kW)',
                        data: [0.8, 0.6, 1.2, 2.8, 1.4, 2.2, 5.1, 3.8, 1.1],
                        borderColor: '#3b82f6',
                        borderDash: [5, 5],
                        yAxisID: 'yAxisPower',
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    yAxisPower: {
                        type: 'linear',
                        position: 'left',
                        grid: { color: 'rgba(255, 255, 255, 0.03)' },
                        ticks: { color: '#64748b', font: { size: 11, weight: 'bold' } },
                        title: { display: true, text: 'Real Power (kW)', color: '#64748b' }
                    },
                    yAxisSOC: {
                        type: 'linear',
                        position: 'right',
                        min: 0,
                        max: 100,
                        grid: { display: false },
                        ticks: { color: '#a855f7', font: { size: 11, weight: 'bold' } },
                        title: { display: true, text: 'State of Charge (%)', color: '#a855f7' }
                    },
                    x: {
                        ticks: { color: '#64748b' },
                        grid: { display: false }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        align: 'end',
                        labels: {
                            color: '#94a3b8',
                            usePointStyle: true,
                            font: { size: 12, weight: '700' }
                        }
                    }
                }
            }
        });

        function logoutSystem() {
            localStorage.removeItem('peakShavingAuth');
            window.location.href = "login.html";
        }
    </script>
</body>
</html>
