<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        if (localStorage.getItem('peakShavingAuth') !== 'true') { 
            window.location.replace("login.html"); 
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Analytics | PeakShaving Professional</title>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css?v=75.0">
</head>
<body class="saas-theme">

    <nav class="main-nav">
        <div class="nav-top">
            <div class="brand-logo">PeakShaving <span>Professional</span></div>
            <div class="nav-links">
                <a href="index.html" class="nav-item">Home Dashboard</a>
                <a href="savings.html" class="nav-item">Financial Savings</a>
                <a href="analytics.html" class="nav-item active">System Analytics</a>
                <button onclick="logout()" class="logout-btn">Logout</button>
            </div>
        </div>
    </nav>

    <main class="scroll-content">
        
        <section class="main-chart-box">
            <div class="box-meta" style="margin-bottom: 30px;">
                <i data-lucide="activity" class="blue-text"></i>
                <span class="box-label">Real-Time Power Balance (24h)</span>
            </div>
            
            <div class="canvas-wrapper">
                <canvas id="powerChart"></canvas>
            </div>
        </section>

        <div class="accumulation-grid">
            <div class="saas-card">
                <div class="acc-top">
                    <i data-lucide="trending-up" class="green-text"></i>
                    <span>Self-Consumption</span>
                </div>
                <div class="acc-main">
                    <strong>88.4</strong> <small>%</small>
                </div>
                <p style="font-size: 0.75rem; color: var(--text-dim); margin-top: 10px;">
                    +2.4% from last week
                </p>
            </div>

            <div class="saas-card">
                <div class="acc-top">
                    <i data-lucide="leaf" class="green-text"></i>
                    <span>Carbon Offset</span>
                </div>
                <div class="acc-main">
                    <strong>412</strong> <small>kg CO2</small>
                </div>
                <p style="font-size: 0.75rem; color: var(--text-dim); margin-top: 10px;">
                    Equivalent to 18 trees
                </p>
            </div>

            <div class="saas-card">
                <div class="acc-top">
                    <i data-lucide="Zap" class="gold-text"></i>
                    <span>Peak Shaved</span>
                </div>
                <div class="acc-main">
                    <strong>12.5</strong> <small>kWh</small>
                </div>
                <p style="font-size: 0.75rem; color: var(--text-dim); margin-top: 10px;">
                    Shifted to Off-Peak
                </p>
            </div>

            <div class="saas-card">
                <div class="acc-top">
                    <i data-lucide="shield-check" class="blue-text"></i>
                    <span>Grid Reliability</span>
                </div>
                <div class="acc-main">
                    <strong>99.9</strong> <small>%</small>
                </div>
                <p style="font-size: 0.75rem; color: var(--text-dim); margin-top: 10px;">
                    Uptime nominal
                </p>
            </div>
        </div>

        <div style="height: 100px;"></div>
    </main>

    <script>
        // Init Icons
        lucide.createIcons();

        // Logout Logic
        function logout() { 
            localStorage.removeItem('peakShavingAuth'); 
            window.location.href = "login.html"; 
        }

        // Chart Initialization
        const ctx = document.getElementById('powerChart').getContext('2d');
        
        // Gradient for Area Chart
        const blueGrad = ctx.createLinearGradient(0, 0, 0, 400);
        blueGrad.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
        blueGrad.addColorStop(1, 'rgba(59, 130, 246, 0)');

        const greenGrad = ctx.createLinearGradient(0, 0, 0, 400);
        greenGrad.addColorStop(0, 'rgba(74, 222, 128, 0.4)');
        greenGrad.addColorStop(1, 'rgba(74, 222, 128, 0)');

        

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '23:59'],
                datasets: [
                    {
                        label: 'Home Load',
                        data: [0.5, 0.4, 1.2, 0.8, 2.5, 1.8, 0.7],
                        borderColor: '#3b82f6',
                        backgroundColor: blueGrad,
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 0
                    },
                    {
                        label: 'Solar Yield',
                        data: [0, 0, 0.5, 3.1, 1.8, 0.2, 0],
                        borderColor: '#4ade80',
                        backgroundColor: greenGrad,
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        labels: { color: '#64748b', font: { weight: '800', size: 10 } }
                    }
                },
                scales: {
                    y: {
                        grid: { color: 'rgba(255,255,255,0.05)' },
                        ticks: { color: '#475569' }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#475569' }
                    }
                }
            }
        });
    </script>
</body>
</html>
